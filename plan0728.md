## 生成AIの仕組みから理解するハルシネーションの原因

生成AIはどのように作られ、みなさんが使うようになっているのか――その流れを**3つの段階（事前学習／強化学習／出力）**に分けて見ていきます。各段階ごとに、どんな“つまずきポイント”があり、どんな種類のハルシネーションにつながるのかも割り当てます。

⸻

### ウォームアップ：身長と体重の関係
何人かの「身長」と「体重」を点で打つと、バラつきはあるけれど右上がりの傾向があることが見えてきます。
点と点の真ん中あたりを通るように、一本のまっすぐな線を微調整して引きます。
データに無い身長でも、その線を使えば「この辺が体重かな？」と見積もれるようになります。

データから「学習」して、未知の値も推し量るという発想がポイント！

この考え方を文章に応用したのが、生成AIです。
データ…大量の文章
予想…文章の続き
たとえば
⸻

ウソにも2タイプある（ここで用語を決めておく）
	•	事実性ハルシネーション：現実世界の事実と食い違う、存在しないものを“ある”と言ってしまうタイプのウソ。
	•	忠実性ハルシネーション：与えた情報源や指示（質問文・プロンプト）に忠実でない答え。聞いてもいないことを勝手に作る／引用元にないことを言う、など。

※この記事では読みやすさのためにこの2分類を使います。細かい学術的分類は他にもありますが、まずはここを押さえればOKです。

1. 事前学習：大量の文章で「次に来る言葉」を当て続ける段階
	1.	本やウェブ記事など、膨大な文章（コーパス）を集める。
	2.	文章の一部を隠して「ここにはどんな言葉が来そう？」という穴埋めクイズを自分で作り、自分で解き続ける（自己教師あり学習）。
	3.	次に来そうな単語たちに「ありそう度」を確率で割り振り、当たりやすくなるように内部の“つまみ”を調整し続ける。

ここで起きやすいハルシネーション（割り当て）
	•	事実性ハルシネーション：コーパスに載っていない／間違っている情報は、そのまま「知らない・誤解している」状態になる。
	•	非公開情報、マイナー情報、最新情報などは特に弱い。

⸻

2. 強化学習：人間が“好む”答え方に寄せる段階（RLHF）
	•	大量の穴埋め練習で身につけた「言葉の当て方」を、人間のフィードバックで微調整します。
	•	目的は、「指示に沿って」「失礼なく安全に」「役に立つように」振る舞わせること。

ここでのトレードオフ（重要！）
	•	この段階で“指示から外れる”タイプ（忠実性）のウソは減りやすい。
	•	その一方で、「ユーザーが言ってほしそう」「高評価されそう」な答えに引っ張られ、現実とズレた“もっともらしい”答え（事実性ハルシネーション）が増えることがある。

つまり：忠実性↓を狙った調整で、事実性↑が副作用的に膨らむ、そんな綱引きが起きがちです。

⸻

3. 出力：確率に従って単語を選ぶ段階
	•	実際に文章を作るときは、候補の単語に振った確率をもとに「次はこれ！」と選んでいく。
	•	連続値のように滑らかな数値を出すのではなく、“候補ボタン”のどれを押すかを確率で決めるイメージ。
	•	確率の高い単語だけを選ぶと機械的で変な文になりやすいため、低めの確率の単語も混ぜることがある（より人間らしい文体に近づく）。

ここで起きやすいハルシネーション（割り当て）
	•	事実性／忠実性どちらも：確率が“もっともらしさ”基準で決まっているため、事実確認なしに選ばれてしまう。
	•	サンプリングの設定（温度、トップPなど）次第で“盛り”が増えることも。

⸻

（再整理）ハルシネーションの原因を3段階に割り当てると

段階	ここで何をしている？	起こりがちなウソのタイプ	なぜそうなる？	ざっくり対策例
1. 事前学習	コーパスから穴埋めクイズで“言葉の当て方”を覚える	事実性	そもそも知らない／誤情報を学習している	ソース付きで聞く・検索/RAGで補う
2. 強化学習 (RLHF)	人間評価で“好ましい答え方”に寄せる	事実性が増えることがある／忠実性は下がりやすい	「言ってほしいこと」に忖度→もっともらしい作り話	「わからない」でOKと教える、ガイドライン明示
3. 出力（サンプリング）	確率に従って単語を選び文章を生成	両方（設定次第で増減）	確率は“もっともらしさ”基準、温度・top-pで揺らぐ	温度・top-p調整、Deterministicモード等の活用

この3段階それぞれで生じる落とし穴を意識しておくと、実際にAIを使うときに「どこでズレたのか？」を切り分けて考えられます。
	•	知らないなら補う（検索・RAG）
	•	言ってほしいことより“正確さ”を明示する（プロンプトで方針共有）
	•	出力設定を調整する（温度0など）
といった工夫で、ハルシネーションと上手につき合っていきましょう。